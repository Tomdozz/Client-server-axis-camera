<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>AXIS Embedded Development SDK: Debugging</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.axis.com"><img alt="Logo" src="axis_logo.png" width="200"/></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">AXIS Embedded Development SDK  
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="files.html"><span>API&#160;Specification</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('debugging.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Debugging </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="about_debugger"></a>
About the debugger</h1>
<p>The debugger consists of two parts:</p><ul>
<li>the client-side <code>gdb</code> (on host)</li>
<li>the <code>gdbserver</code> on the Axis product. The <code>gdbserver</code> is <b>not</b> included in official firmwares releases. Contact the ADP Helpdesk to request a debug firmware for your product.</li>
</ul>
<p>Quick links to sections on this page:</p><ul>
<li><a class="el" href="debugging.html#installing_gdb">Installing the debugger on host</a></li>
<li><a class="el" href="debugging.html#cross_compile_debug">Cross compiling and uploading the product before debugging</a></li>
<li><a class="el" href="debugging.html#gdbserver">Starting gdbserver on the Axis product</a></li>
<li><a class="el" href="debugging.html#mips_gdb">Set up the GNU debugger or gdb</a></li>
<li><a class="el" href="debugging.html#cross_compile_duma">Cross compiling for debugging with DUMA</a></li>
<li><a class="el" href="debugging.html#debug_duma">Using gdb and gdbserver with DUMA</a></li>
<li><a class="el" href="debugging.html#debug_syslog">Using the system log or syslog for debugging</a></li>
</ul>
<h1><a class="anchor" id="installing_gdb"></a>
Installing the debugger on host</h1>
<h2><a class="anchor" id="gdb_artpec4"></a>
Artpec-4</h2>
<p>For products with Artpec-4, install <code>gdb-mips</code> on host. Contact the ADP Helpdesk to request Debian, RPM and .tar.gz packages.</p>
<h2><a class="anchor" id="gdb_ambarella"></a>
Ambarella</h2>
<p>For products with Ambarella, contact the ADP Helpdesk to request Debian, RPM and .tar.gz packages.</p>
<h1><a class="anchor" id="cross_compile_debug"></a>
Cross compiling and uploading the product before debugging</h1>
<p>In the example on this page, the example application <code>analyze</code> will be debugged. The Axis product's IP address is <code>&lt;camera_ip&gt;</code>. Do not strip the binary before uploading it to the Axis product.</p>
<p>Create the application package in the <code>apps/analyze</code> directory: </p><pre class="fragment">user@host$ make debug
user@host$ make clean
user@host$ create-package.sh</pre><p>Upload the application package to the Axis product: </p><pre class="fragment">user@host$ eap-install.sh &lt;camera_ip&gt; &lt;root_password&gt; install</pre><h1><a class="anchor" id="gdbserver"></a>
Starting gdbserver on the Axis product</h1>
<p>When the application is compiled and uploaded, start <code>gdbserver</code> on the Axis product after logging in as root: </p><pre class="fragment">user@host$ssh &lt;camera_ip&gt;
root@camera# cd /usr/local/packages/analyze/
root@camera# gdbserver :1234 analyze</pre><p> In this example, port 1234 is used. If required, another port can be chosen.</p>
<h1><a class="anchor" id="mips_gdb"></a>
Set up the GNU debugger or gdb</h1>
<p>To start the GNU debugger use the wrapper script <code>rungdb</code>. From the <code>analyze</code> directory, launch the <code>rungdb</code> script and type <code>targ</code> at the <code>gdb</code> prompt to connect to the target (the Axis product). Type <code>det</code> to detach from the target. </p><pre class="fragment">user@host$ rungdb analyze
(gdb) targ
0x3aaac8b0 in _start () from /home/user/...
(gdb) det
Ending remote debugging.</pre><p>The <code>rungdb</code> script will use the target IP address defined by <code>AXIS_TARGET_IP</code> (default is 192.168.0.90), and the port defined by <code>AXIS_GDB_PORT</code> (default 1234). The script will automatically set up the debugger for the target architecture and load the debugging symbols for the <code>analyze</code> program. By setting custom network parameters, it is possible to override the environment variables: </p><pre class="fragment">user@host$ AXIS_TARGET_IP=&lt;target_ip&gt; AXIS_GDB_PORT=&lt;debug_port_chosen&gt; rungdb analyze</pre><p>To obtain extra control, it is also possible to set up the debugger manually. Make sure to specify the same port as the one used to start <code>gdbserver</code> above. </p><pre class="fragment">user@host$ gdb-mips analyze
(gdb) set solib-absolute-prefix /dev/null
(gdb) set solib-search-path &lt;path to SDK&gt;/target/mipsisa32r2el-axis-linux-gnu/lib
(gdb) directory &lt;path-to-camera&gt;/usr/lib/mylib        //specify where a shared library "mylib" is located (if needed by the analyze program)
(gdb) target remote &lt;camera_ip&gt;:&lt;debug_port&gt;
Remote debugging using &lt;camera_ip&gt;:&lt;debug_port&gt;
0x3aaac8b0 in _start () from /home/user/...</pre><h2><a class="anchor" id="start_debug"></a>
Start debugging</h2>
<p>Debugging can be started by setting a <code>breakpoint</code> at the <code>main()</code> function of the program and using <code>continue</code> to reach and stop the debugger at breakpoint 1: </p><pre class="fragment">(gdb) break main
Breakpoint 1 at (some hexadecimal address): file main.c, line (some line
number).
(gdb) c
Continuing.

Breakpoint 1, main (argc=..., argv=...) at main.c:(some line number)
(line number) (the first line of C code following main())</pre><p>To follow a child process in <code>gdb</code>, set the following variable at the <code>gdb</code> prompt: </p><pre class="fragment">(gdb) set follow-fork-mode child</pre><h1><a class="anchor" id="cross_compile_duma"></a>
Cross compiling for debugging with DUMA</h1>
<p>DUMA is an open-source library (under GNU General Public License) to detect memory leaks, buffer overruns and underruns in C and C++ programs. The DUMA library version available in this SDK is: DUMA 2.5.14.</p>
<p>When compiling an application with debugging information, make sure that the <code>Makefile</code> contains the following: </p><pre class="fragment"># Add libraries here
LDFLAGS += -lpthread
LDLIBS   += $(prefix)/lib/libduma.a</pre><p>To cross compile the application with DUMA and debugging information, run: </p><pre class="fragment">user@host$ make debug
user@host$ make clean
user@host$ create-package.sh</pre><p>The first <code>make</code> instructs the build system to build the application with debug flags, and link the static DUMA library. The second <code>make</code> cleans the directory. The <code>create-package.sh</code> script creates the application package to be uploaded.</p>
<h2><a class="anchor" id="debug_duma"></a>
Using gdb and gdbserver with DUMA</h2>
<p>When the application is compiled and uploaded (see above), run: </p><pre class="fragment">user@host$ rungdb your_application</pre><p>DUMA cannot detect underruns and overruns at the same time. The default setting is to detect overruns. To detect underruns, set the variable <code>DUMA_PROTECT_BELOW:</code> </p><pre class="fragment">root@camera# export DUMA_PROTECT_BELOW=1
root@camera# gdbserver :1234 your_application</pre><p>Run and wait for the segmentation fault resulting from the application receiving signal <code>SIGSEGV</code>. If the program has been built with debug and has included the duma.h header file, DUMA will report the source file and the line number where the error occurred. More information can be found in the DUMA's User Manual, available at: <a href="http://duma.cvs.sourceforge.net/duma/duma/README.txt?view=markup&amp;pathrev=VERSION_2_5_14" target="_blank">http://duma.cvs.sourceforge.net/duma/duma/README.txt?view=markup&amp;pathrev=VERSION_2_5_14</a></p>
<h3><a class="anchor" id="duma_ex"></a>
Application examples using the DUMA memory debugging library</h3>
<p>The directory <code>apps/duma</code> contains the following examples: </p><pre class="fragment">apps/duma/example1.c - Simulate a memory leak
apps/duma/example2.c - Fixes the memory leakage in example1.c
apps/duma/example3.c - Simulates a buffer overrun
apps/duma/example4.c - Fixes the buffer overrun in example3.c
apps/duma/example5.c - Simulates a buffer underrun</pre><p>To build and test the examples, follow the procedure described in <a class="el" href="debugging.html#cross_compile_duma">Cross compiling for debugging with DUMA</a> and <a class="el" href="debugging.html#debug_duma">Using gdb and gdbserver with DUMA</a>.</p>
<h1><a class="anchor" id="debug_syslog"></a>
Using the system log or syslog for debugging</h1>
<p>To write messages with different priorities (<code>INFO</code>, <code>CRITICAL</code>, <code>WARNING</code>) in the Axis product's system log, include the lines of code below in the application. This information can later be extracted from the system log through the Axis product's URL or web pages.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;syslog.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {</div>
<div class="line">        <span class="comment">/* Open the syslog for reporting messages for &quot;analyze&quot; */</span></div>
<div class="line">        openlog(<span class="stringliteral">&quot;analyze&quot;</span>, LOG_PID|LOG_CONS, LOG_USER);</div>
<div class="line">        <span class="comment">/* Choose between { LOG_INFO, LOG_CRIT, LOG_WARN }*/</span></div>
<div class="line">        syslog(LOG_INFO, <span class="stringliteral">&quot;Starting...&quot;</span>);</div>
<div class="line">        <span class="comment">/* etc... */</span></div>
<div class="line">        closelog();</div>
<div class="line">}</div>
</div><!-- fragment --><p>To extract the messages, go to <a href="http://camera_ip/devtools.shtml" target="_blank">http://camera_ip/devtools.shtml</a> or use the following URL: </p><pre class="fragment">http://&lt;camera_ip&gt;/axis-cgi/systemlog.cgi?appname=analyze</pre><p>In this example, the system log contains the following information: </p><pre class="fragment">----- Contents of /var/log/messages for 'analyze' -----

&lt;INFO&gt; Oct 14 09:19:20 axis-00408c183690 analyze[2284]: Starting...</pre><p> <p class="previous"> <a href="application_package.html"><< Creating an Application Package</a> <p>
<p class="next"> <a href="profiling.html">Profiling >></a> <p>  </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.4-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li id="footer1">Copyright &copy; 2009-2015 Axis Communications AB. All rights reserved.  
	 </li>	 
	<li id="footer2">		     
	AXIS Embedded Development SDK version 2.0.2. Created: Fri Jul 17 2015.</li>     	
  </ul>
</div>
</body>
</html>
